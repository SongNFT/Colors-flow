{"ast":null,"code":"import { Ok as n, isTransaction as r, pipe as e } from \"@onflow/interaction\";\n\nfunction t() {\n  return (t = Object.assign || function (n) {\n    for (var r = 1; r < arguments.length; r++) {\n      var e = arguments[r];\n\n      for (var t in e) Object.prototype.hasOwnProperty.call(e, t) && (n[t] = e[t]);\n    }\n\n    return n;\n  }).apply(this, arguments);\n}\n\nvar o = \"undefined\" != typeof Symbol ? Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\")) : \"@@iterator\";\n\nfunction i(n, r, e) {\n  if (!n.s) {\n    if (e instanceof u) {\n      if (!e.s) return void (e.o = i.bind(null, n, r));\n      1 & r && (r = e.s), e = e.v;\n    }\n\n    if (e && e.then) return void e.then(i.bind(null, n, r), i.bind(null, n, 2));\n    n.s = r, n.v = e;\n    var t = n.o;\n    t && t(n);\n  }\n}\n\nvar u = function () {\n  function n() {}\n\n  return n.prototype.then = function (r, e) {\n    var t = new n(),\n        o = this.s;\n\n    if (o) {\n      var u = 1 & o ? r : e;\n\n      if (u) {\n        try {\n          i(t, 1, u(this.v));\n        } catch (n) {\n          i(t, 2, n);\n        }\n\n        return t;\n      }\n\n      return this;\n    }\n\n    return this.o = function (n) {\n      try {\n        var o = n.v;\n        1 & n.s ? i(t, 1, r ? r(o) : o) : e ? i(t, 1, e(o)) : i(t, 2, o);\n      } catch (n) {\n        i(t, 2, n);\n      }\n    }, t;\n  }, n;\n}();\n\nfunction c(n) {\n  return n instanceof u && 1 & n.s;\n}\n\nvar a = function (n) {\n  return \"function\" == typeof n;\n},\n    f = function (n) {\n  return \"number\" == typeof n;\n},\n    l = function (n) {\n  return \"string\" == typeof n;\n},\n    s = function (n, r) {\n  if (!n) {\n    var e,\n        t = new Error(\"INVARIANT \" + r);\n    throw t.stack = t.stack.split(\"\\n\").filter(function (n) {\n      return !/at invariant/.test(n);\n    }).join(\"\\n\"), (e = console).error.apply(e, [\"\\n\\n---\\n\\n\", t, \"\\n\\n\"].concat([].slice.call(arguments, 2), [\"\\n\\n---\\n\\n\"])), t;\n  }\n},\n    p = function (n) {\n  return !(n.role.proposer && !(l(n.addr) && f(n.keyId) && f(n.sequenceNum) && a(n.signingFunction)) || n.role.payer && !(l(n.addr) && f(n.keyId) && a(n.signingFunction)) || n.role.authorizer && !(l(n.addr) && f(n.keyId) && a(n.signingFunction)));\n},\n    d = function (n) {\n  return void 0 === n && (n = []), n.filter(Boolean)[0] || null;\n},\n    v = function (n) {\n  return void 0 === n && (n = []), n.find(function (n) {\n    return n.role.proposer;\n  }) || {};\n},\n    h = function (e) {\n  try {\n    var t = function () {\n      return n(e);\n    };\n\n    if (!r(e)) return Promise.resolve(n(e));\n\n    var f = function (n, r, e) {\n      if (\"function\" == typeof n[o]) {\n        var t,\n            a,\n            f,\n            l = n[o]();\n\n        if (function n(e) {\n          try {\n            for (; !(t = l.next()).done;) if ((e = r(t.value)) && e.then) {\n              if (!c(e)) return void e.then(n, f || (f = i.bind(null, a = new u(), 2)));\n              e = e.v;\n            }\n\n            a ? i(a, 1, e) : a = e;\n          } catch (n) {\n            i(a || (a = new u()), 2, n);\n          }\n        }(), l.return) {\n          var s = function (n) {\n            try {\n              t.done || l.return();\n            } catch (n) {}\n\n            return n;\n          };\n\n          if (a && a.then) return a.then(s, function (n) {\n            throw s(n);\n          });\n          s();\n        }\n\n        return a;\n      }\n\n      if (!(\"length\" in n)) throw new TypeError(\"Object is not iterable\");\n\n      for (var p = [], d = 0; d < n.length; d++) p.push(n[d]);\n\n      return function (n, r, e) {\n        var t,\n            o,\n            a = -1;\n        return function e(f) {\n          try {\n            for (; ++a < n.length;) if ((f = r(a)) && f.then) {\n              if (!c(f)) return void f.then(e, o || (o = i.bind(null, t = new u(), 2)));\n              f = f.v;\n            }\n\n            t ? i(t, 1, f) : t = f;\n          } catch (n) {\n            i(t || (t = new u()), 2, n);\n          }\n        }(), t;\n      }(p, function (n) {\n        return r(p[n]);\n      });\n    }(Object.entries(e.accounts), function (n) {\n      var r = n[0],\n          t = n[1];\n\n      function o() {\n        s(p(e.accounts[r]), \"Account unable to fulfill role\", e.accounts[r]);\n      }\n\n      var i = function () {\n        if (a(t.resolve)) return Promise.resolve(t.resolve(t)).then(function (n) {\n          e.accounts[r] = n;\n        });\n      }();\n\n      return i && i.then ? i.then(o) : o();\n    });\n\n    return Promise.resolve(f && f.then ? f.then(t) : t());\n  } catch (n) {\n    return Promise.reject(n);\n  }\n},\n    y = function (e) {\n  try {\n    if (!r(e)) return Promise.resolve(n(e));\n\n    for (var o = function () {\n      var n,\n          r,\n          o,\n          c = u[i],\n          a = c.addr + \"|\" + c.keyId;\n      e.accounts[a] = null != e.accounts[a] ? (n = e.accounts[a], r = t({\n        tempId: a\n      }, c), {\n        kind: d([n.kind, r.kind]),\n        tempId: d([n.tempId, r.tempId]),\n        addr: d([n.addr, r.addr]),\n        keyId: (o = [n.keyId, r.keyId], void 0 === o && (o = []), \"number\" == typeof o.filter(f)[0] ? o.filter(f)[0] : null),\n        sequenceNum: \"number\" == typeof v([n, r]).sequenceNum ? v([n, r]).sequenceNum : n.sequenceNum,\n        signature: d([n.signature, r.signature]),\n        signingFunction: d([n.signingFunction, r.signingFunction]),\n        resolve: d([n.resolve, r.resolve]),\n        role: {\n          proposer: n.role.proposer || r.role.proposer,\n          authorizer: n.role.authorizer || r.role.authorizer,\n          payer: n.role.payer || r.role.payer,\n          param: n.role.param || r.role.param\n        }\n      }) : t({\n        tempId: a\n      }, c), e.proposer === c.tempId && (e.proposer = a), e.payer === c.tempId && (e.payer = a), e.authorizations = e.authorizations.map(function (n) {\n        return n === c.tempId ? a : n;\n      }), delete e.accounts[c.tempId];\n    }, i = 0, u = Object.values(e.accounts); i < u.length; i++) o();\n\n    for (var c = 0, a = Object.values(e.accounts); c < a.length; c++) {\n      var l = a[c];\n      s(p(l), \"Account unable to fulfill roles\", l);\n    }\n\n    return Promise.resolve(n(e));\n  } catch (n) {\n    return Promise.reject(n);\n  }\n},\n    m = e([h, y]);\n\nexport { y as dedupeResolvedAccounts, h as enforceResolvedAccounts, m as resolveAccounts };","map":{"version":3,"sources":["../src/index.js"],"names":["isFn","d","_Pact","isNumber","prototype","then","onFulfilled","onRejected","isString","result","state","this","s","fact","msg","callback","error","Error","stack","_settle","split","v","filter","e","test","join","console","accountCanFulfillRoles","account","o","role","proposer","_this","value","keyId","signingFunction","payer","addr","authorizer","pact","firstNonNull","values","Boolean","bind","accounts","find","into","from","kind","tempId","observer","sequenceNum","findProposer","signature","_isSettledPact","thenable","resolve","param","enforceResolvedAccounts","ix","isTransaction","Ok","Object","entries","invariant","dedupeResolvedAccounts","cid","authorizations","map","array","body","check","i","reject","_cycle","resolveAccounts","length","pipe","Symbol","iterator","target","_iteratorSymbol","step","next","done","_fixup","TypeError","push","_forTo"],"mappings":";;;;;;;;;;;;;;QAoK+D,eAAA,OAAX8E,MAAW,GAAeA,MAAAA,CAAOC,QAAPD,KAAoBA,MAAAA,CAAOC,QAAPD,GAAkBA,MAAAA,CAAO,iBAAPA,CAAtCA,CAAf,GAAmF,Y;;AA7H3I,SAAS3D,CAAT,CAAiBoB,CAAjB,EAAuB7B,CAAvB,EAA8BuB,CAA9B,EAA8BA;AACpC,MAAA,CAAKM,CAAAA,CAAK3B,CAAV,EAAa;AACZ,QAAIqB,CAAAA,YAAiB/B,CAArB,EAA4B;AAC3B,UAAA,CAAI+B,CAAAA,CAAMrB,CAAV,EAOC,OAAA,MADAqB,CAAAA,CAAMJ,CAANI,GAAUd,CAAAA,CAAQwB,IAARxB,CAAa,IAAbA,EAAmBoB,CAAnBpB,EAAyBT,CAAzBS,CACV,CAAA;AANY,UAART,CAAQ,KACXA,CAAAA,GAAQuB,CAAAA,CAAMrB,CADH,GAGZqB,CAAAA,GAAQA,CAAAA,CAAMZ,CAHF;AASd;;AAAA,QAAIY,CAAAA,IAASA,CAAAA,CAAM5B,IAAnB,EAEC,OAAA,KADA4B,CAAAA,CAAM5B,IAAN4B,CAAWd,CAAAA,CAAQwB,IAARxB,CAAa,IAAbA,EAAmBoB,CAAnBpB,EAAyBT,CAAzBS,CAAXc,EAA4Cd,CAAAA,CAAQwB,IAARxB,CAAa,IAAbA,EAAmBoB,CAAnBpB,EAAyB,CAAzBA,CAA5Cc,CACA;AAEDM,IAAAA,CAAAA,CAAK3B,CAAL2B,GAAS7B,CAAT6B,EACAA,CAAAA,CAAKlB,CAALkB,GAASN,CADTM;AAEA,QAAMW,CAAAA,GAAWX,CAAAA,CAAKV,CAAtB;AACIqB,IAAAA,CAAAA,IACHA,CAAAA,CAASX,CAATW,CADGA;AACMX;AAAAA;;AAAAA,IAAAA,CAAAA,GA3DuB,YAAA;AAClC,WAAA,CAAA,GAAA,CAiCA;;AAAA,SAhCArC,CAAAA,CAAME,SAANF,CAAgBG,IAAhBH,GAAuB,UAASI,CAAT,EAAsBC,CAAtB,EAAsBA;AAC5C,QAAME,CAAAA,GAAS,IAAA,CAAA,EAAf;AAAA,QACMC,CAAAA,GAAQC,KAAKC,CADnB;;AAEA,QAAIF,CAAJ,EAAW;AACV,UAAMK,CAAAA,GAAmB,IAARL,CAAQ,GAAIJ,CAAJ,GAAkBC,CAA3C;;AACA,UAAIQ,CAAJ,EAAc;AACb,YAAA;AACCI,UAAAA,CAAAA,CAAQV,CAARU,EAAgB,CAAhBA,EAAmBJ,CAAAA,CAASJ,KAAKU,CAAdN,CAAnBI,CAAAA;AACC,SAFF,CAEE,OAAOI,CAAP,EAAOA;AACRJ,UAAAA,CAAAA,CAAQV,CAARU,EAAgB,CAAhBA,EAAmBI,CAAnBJ,CAAAA;AAED;;AAAA,eAAOV,CAAP;AAEA;;AAAA,aAAA,IAAA;AAiBF;;AAAA,WAdAE,KAAKkB,CAALlB,GAAS,UAASqB,CAAT,EAASA;AACjB,UAAA;AACC,YAAMC,CAAAA,GAAQD,CAAAA,CAAMX,CAApB;AACc,YAAVW,CAAAA,CAAMpB,CAAI,GACbO,CAAAA,CAAQV,CAARU,EAAgB,CAAhBA,EAAmBb,CAAAA,GAAcA,CAAAA,CAAY2B,CAAZ3B,CAAdA,GAAmC2B,CAAtDd,CADa,GAEHZ,CAAAA,GACVY,CAAAA,CAAQV,CAARU,EAAgB,CAAhBA,EAAmBZ,CAAAA,CAAW0B,CAAX1B,CAAnBY,CADUZ,GAGVY,CAAAA,CAAQV,CAARU,EAAgB,CAAhBA,EAAmBc,CAAnBd,CALa;AAOb,OATF,CASE,OAAOI,CAAP,EAAOA;AACRJ,QAAAA,CAAAA,CAAQV,CAARU,EAAgB,CAAhBA,EAAmBI,CAAnBJ,CAAAA;AAAmBI;AAAAA,KAXrBZ,EAcOF,CAAP;AAAOA,GA9BRP,EA8BQO,CAER;AAlCkC,CAAA,EA2DvB8B;;AAKL,SAASe,CAAT,CAAwBC,CAAxB,EAAwBA;AAC9B,SAAOA,CAAAA,YAAoBrD,CAApBqD,IAA0C,IAAbA,CAAAA,CAAS3C,CAA7C;AAA6CA;;AAAAA,IAhExCZ,CAAAA,GAAO,UAAA,CAAA,EAAA;AAAA,SAAkB,cAAA,OAANC,CAAZ;AAAYA,CAgEqBW;AAAAA,IA/DxCT,CAAAA,GAAWE,UAAAA,CAAAA,EAAAA;AAAAA,SAAkB,YAAA,OAANJ,CAAZI;AAAYJ,CA+DiBW;AAAAA,IA9DxCJ,CAAAA,GAAW,UAAA,CAAA,EAAA;AAAA,SAAkB,YAAA,OAANP,CAAZ;AAAYA,CA8DiBW;AAAAA,IA5DxCF,CAAAA,GAAY,UAACG,CAAD,EAAOC,CAAP,EAAOA;AACvB,MAAA,CAAKD,CAAL,EAAW;AAAA,QAAA,CAAA;AAAA,QACHG,CAAAA,GAAQ,IAAIC,KAAJ,CAAIA,eAAmBH,CAAvB,CADL;AAOT,UALA,CAAA,CAAMI,KAAN,GAAcF,CAAAA,CAAME,KAANF,CACXI,KADWJ,CACLP,IADKO,EAEXM,MAFWN,CAEJ,UAAA,CAAA,EAAA;AAAA,aAAA,CAAM,eAAeQ,IAAf,CAAoBvB,CAApB,CAAN;AAA0BA,KAFtBe,EAGXS,IAHWT,CAGN,IAHMA,CAAd,EAGQ,CAAA,CAAA,GACRU,OADQ,EACAV,KADA,CACAA,KADA,CACAA,CADA,EACAA,CAAM,aAANA,EAAqBA,CAArBA,EAA4B,MAA5BA,EAA4B,MAA5BA,CAA4B,GAAA,KAAA,CAAA,IAAA,CAAA,SAAA,EAAA,CAAA,CAA5BA,EAA4B,CAAiB,aAAjB,CAA5BA,CADA,CAHR,EAKMA,CAAN;AAAMA;AAAAA,CAoDoCJ;AAAAA,IAhDxCe,CAAAA,GAAyB,UAAA,CAAA,EAAA;AAC7BhB,SAAAA,EAAIiB,CAAAA,CAAQE,IAARF,CAAaG,QAAbH,IAAaG,EAEZvB,CAAAA,CAASoB,CAAAA,CAAQP,IAAjBb,CAAAA,IACAL,CAAAA,CAASyB,CAAAA,CAAQM,KAAjB/B,CADAK,IAEAL,CAAAA,CAASyB,CAAAA,CAAQtB,WAAjBH,CAFAK,IAGAR,CAAAA,CAAK4B,CAAAA,CAAQO,eAAbnC,CALY+B,CAAbH,IASAA,CAAAA,CAAQE,IAARF,CAAaQ,KAAbR,IAAaQ,EAEZ5B,CAAAA,CAASoB,CAAAA,CAAQS,IAAjB7B,CAAAA,IACAL,CAAAA,CAASyB,CAAAA,CAAQM,KAAjB/B,CADAK,IAEAR,CAAAA,CAAK4B,CAAAA,CAAQO,eAAbnC,CAJYoC,CATbR,IAiBAA,CAAAA,CAAQE,IAARF,CAAaU,UAAbV,IAAaU,EAEZ9B,CAAAA,CAASoB,CAAAA,CAAQS,IAAjB7B,CAAAA,IACA,CAAA,CAASW,CAAAA,CAAQoB,KAAjB,CADA/B,IAEAR,CAAAA,CAAK4B,CAAAA,CAAQO,eAAbnC,CAJYsC,CAjBjB3B,CAAAA;AAqBkBwB,CA0B0BvB;AAAAA,IAnBxC4B,CAAAA,GAAe,UAACC,CAAD,EAACA;AAAAA,SAAAA,KAAAA,CAAAA,KAAAA,CAAAA,KAAAA,CAAAA,GAAS,EAATA,GAAgBA,CAAAA,CAAOnB,MAAPmB,CAAcC,OAAdD,EAAuB,CAAvBA,KAA6B,IAA7CA;AAA6C,CAmBrB7B;AAAAA,IAdxCqB,CAAAA,GAAe5B,UAACuC,CAADvC,EAACuC;AAAAA,SAAAA,KAAAA,CAAAA,KAAAA,CAAAA,KAAAA,CAAAA,GAAW,EAAXA,GACpBA,CAAAA,CAASC,IAATD,CAAc,UAAA,CAAA,EAAA;AAAA,WAAK3C,CAAAA,CAAE6B,IAAF7B,CAAO8B,QAAZ;AAAYA,GAA1Ba,KAAuC,EADnBA;AACmB,CAaKhC;AAAAA,IASjC8C,CAAAA,GAAAA,UAAgCC,CAAhCD,EAAgCC;AAAAA,MAAAA;AAAAA,QAAAA,CAAAA,GAAAA,YAAAA;AAW3C,aAAOE,CAAAA,CAAGF,CAAHE,CAAP;AAAUF,KAXiCA;;AAC3C,QAAA,CAAKC,CAAAA,CAAcD,CAAdC,CAAL,EAAwB,OAAA,OAAA,CAAA,OAAA,CAAOC,CAAAA,CAAGF,CAAHE,CAAP,CAAA;;AADyB,QAAA,CAAA,GA6F5C,UAAgBmB,CAAhB,EAAwBV,CAAxB,EAA8BC,CAA9B,EAA8BA;AACpC,UAAuC,cAAA,OAA5BS,CAAAA,CAAOC,CAAPD,CAAX,EAAmD;AAAA,YACRE,CADQ;AAAA,YACF3C,CADE;AAAA,YACIkC,CADJ;AAAA,YAC9CM,CAAAA,GAAWC,CAAAA,CAAOC,CAAPD,CAAAA,EADmC;;AAyBlD,YAvBA,SAASN,CAAT,CAAgBjE,CAAhB,EAAgBA;AACf,cAAA;AACC,mBAAA,CAAA,CAASyE,CAAAA,GAAOH,CAAAA,CAASI,IAATJ,EAAhB,EAAiCK,IAAjC,GAEC,IAAA,CADA3E,CAAAA,GAAS6D,CAAAA,CAAKY,CAAAA,CAAKjD,KAAVqC,CACT,KAAc7D,CAAAA,CAAOJ,IAArB,EAA2B;AAC1B,kBAAA,CAAIiD,CAAAA,CAAe7C,CAAf6C,CAAJ,EAIC,OAAA,KADA7C,CAAAA,CAAOJ,IAAPI,CAAYiE,CAAZjE,EAAoBgE,CAAAA,KAAWA,CAAAA,GAAStD,CAAAA,CAAQwB,IAARxB,CAAa,IAAbA,EAAmBoB,CAAAA,GAAO,IAAIrC,CAAJ,EAA1BiB,EAAuC,CAAvCA,CAApBsD,CAApBhE,CACA;AAHAA,cAAAA,CAAAA,GAASA,CAAAA,CAAOY,CAAhBZ;AAOC8B;;AAAAA,YAAAA,CAAAA,GACHpB,CAAAA,CAAQoB,CAARpB,EAAc,CAAdA,EAAiBV,CAAjBU,CADGoB,GAGHA,CAAAA,GAAO9B,CAHJ8B;AAKH,WAjBF,CAiBE,OAAOhB,CAAP,EAAOA;AACRJ,YAAAA,CAAAA,CAAQoB,CAAAA,KAASA,CAAAA,GAAO,IAAIrC,CAAJ,EAAhBqC,CAARpB,EAAsC,CAAtCA,EAAyCI,CAAzCJ,CAAAA;AAAyCI;AAG3CmD,SAtBA,IAuBIK,CAAAA,CAAAA,MAAJ,EAAqB;AACpB,cAAIM,CAAAA,GAAS,UAASpD,CAAT,EAASA;AACrB,gBAAA;AACMiD,cAAAA,CAAAA,CAAKE,IAALF,IACJH,CAAAA,CAAAA,MAAAA,EADIG;AAGJ,aAJF,CAIE,OAAM3D,CAAN,EAAMA,CAER;;AAAA,mBAAOU,CAAP;AAAOA,WAPR;;AASA,cAAIM,CAAAA,IAAQA,CAAAA,CAAKlC,IAAjB,EACC,OAAOkC,CAAAA,CAAKlC,IAALkC,CAAU8C,CAAV9C,EAAkB,UAAShB,CAAT,EAASA;AACjC,kBAAM8D,CAAAA,CAAO9D,CAAP8D,CAAN;AAAa9D,WADPgB,CAAP;AAID8C,UAAAA,CAAAA;AAED;;AAAA,eAAO9C,CAAP;AAGD;;AAAA,UAAA,EAAM,YAAYyC,CAAlB,CAAA,EACC,MAAA,IAAUM,SAAV,CAAoB,wBAApB,CAAA;;AAID,WADA,IAAI7C,CAAAA,GAAS,EAAb,EACS+B,CAAAA,GAAI,CAAb,EAAgBA,CAAAA,GAAIQ,CAAAA,CAAOJ,MAA3B,EAAmCJ,CAAAA,EAAnC,EACC/B,CAAAA,CAAO8C,IAAP9C,CAAYuC,CAAAA,CAAOR,CAAPQ,CAAZvC;;AAED,aA5GM,UAAgB4B,CAAhB,EAAuBC,CAAvB,EAA6BC,CAA7B,EAA6BA;AACnC,YAAYhC,CAAZ;AAAA,YAAkBkC,CAAlB;AAAA,YAAID,CAAAA,GAAAA,CAAK,CAAT;AAwBA,eAvBA,SAASE,CAAT,CAAgBjE,CAAhB,EAAgBA;AACf,cAAA;AACC,mBAAA,EAAS+D,CAAT,GAAaH,CAAAA,CAAMO,MAAnB,GAEC,IAAA,CADAnE,CAAAA,GAAS6D,CAAAA,CAAKE,CAALF,CACT,KAAc7D,CAAAA,CAAOJ,IAArB,EAA2B;AAC1B,kBAAA,CAAIiD,CAAAA,CAAe7C,CAAf6C,CAAJ,EAIC,OAAA,KADA7C,CAAAA,CAAOJ,IAAPI,CAAYiE,CAAZjE,EAAoBgE,CAAAA,KAAWA,CAAAA,GAAStD,CAAAA,CAAQwB,IAARxB,CAAa,IAAbA,EAAmBoB,CAAAA,GAAO,IAAIrC,CAAJ,EAA1BiB,EAAuC,CAAvCA,CAApBsD,CAApBhE,CACA;AAHAA,cAAAA,CAAAA,GAASA,CAAAA,CAAOY,CAAhBZ;AAOC8B;;AAAAA,YAAAA,CAAAA,GACHpB,CAAAA,CAAQoB,CAARpB,EAAc,CAAdA,EAAiBV,CAAjBU,CADGoB,GAGHA,CAAAA,GAAO9B,CAHJ8B;AAKH,WAjBF,CAiBE,OAAOhB,CAAP,EAAOA;AACRJ,YAAAA,CAAAA,CAAQoB,CAAAA,KAASA,CAAAA,GAAO,IAAIrC,CAAJ,EAAhBqC,CAARpB,EAAsC,CAAtCA,EAAyCI,CAAzCJ,CAAAA;AAAyCI;AAG3CmD,SAtBA,IAuBOnC,CAAP;AAmFOiD,OA5GD,CA4GQ/C,CA5GR,EA4GgB,UAAS+B,CAAT,EAASA;AAAK,eAAOF,CAAAA,CAAK7B,CAAAA,CAAO+B,CAAP/B,CAAL6B,CAAP;AAAmBE,OA5GjD,CA4GN;AAAuDA,KAtDjD,CA3FyBV,MAAAA,CAAOC,OAAPD,CAAeH,CAAAA,CAAGf,QAAlBkB,CA2FzB,EA3F2ClB,UAAAA,CAAAA,EAAAA;AAAAA,UAAtCK,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,CAAsCL;AAAAA,UAA9BhB,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,CAA8BgB;;AAA9BhB,eAAAA,CAAAA,GAAAA;AAGhBoC,QAAAA,CAAAA,CACErC,CAAAA,CAAuBgC,CAAAA,CAAGf,QAAHe,CAAYV,CAAZU,CAAvBhC,CADFqC,EAEE,gCAFFA,EAGEL,CAAAA,CAAGf,QAAHe,CAAYV,CAAZU,CAHFK,CAAAA;AAGcf;;AAAAA,UAAAA,CAAAA,GAAAA,YAAAA;AALd,YAAIjD,CAAAA,CAAK4B,CAAAA,CAAQ4B,OAAbxD,CAAJ,EAAiBwD,OAAAA,OAAAA,CAAAA,OAAAA,CACa5B,CAAAA,CAAQ4B,OAAR5B,CAAgBA,CAAhBA,CADb4B,EAC6B5B,IAD7B4B,CAC6B5B,UAAAA,CAAAA,EAAAA;AAA5C+B,UAAAA,CAAAA,CAAGf,QAAHe,CAAYV,CAAZU,IAAYV,CAAZU;AAAYV,SADGO,CAAAA;AACHP,OAIAA,EAAAA;;AAJAA,aAAAA,CAAAA,IAAAA,CAAAA,CAAAA,IAAAA,GAAAA,CAAAA,CAAAA,IAAAA,CAAAA,CAAAA,CAAAA,GAAAA,CAAAA,EAAAA;AAAAA,KAyFX,CA7F4C;;AAIjCA,WAAAA,OAAAA,CAAAA,OAAAA,CAAAA,CAAAA,IAAAA,CAAAA,CAAAA,IAAAA,GAAAA,CAAAA,CAAAA,IAAAA,CAAAA,CAAAA,CAAAA,GAAAA,CAAAA,EAAAA,CAAAA;AAJkB,GAASU,CAAT,OAAA,CAAA,EAAA;AAAA,WAAA,OAAA,CAAA,MAAA,CAAA,CAAA,CAAA;AAAA;AAAA,CATU/C;AAAAA,IAuBjCqD,CAAAA,GAAAA,UAA+BN,CAA/BM,EAA+BN;AAAAA,MAAAA;AAC1C,QAAA,CAAKC,CAAAA,CAAcD,CAAdC,CAAL,EAAwB,OAAA,OAAA,CAAA,OAAA,CAAOC,CAAAA,CAAGF,CAAHE,CAAP,CAAA;;AACxB,SAFgD,IAAA,CAAA,GAAA,YAAA;AAE3C,UApCmBf,CAoCnB;AAAA,UApCyBC,CAoCzB;AAAA,UA3CoB,CA2CpB;AAAA,UAAInB,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,CAAJ;AAAA,UACGsC,CAAAA,GAAStC,CAAAA,CAAQS,IAART,GAAQS,GAART,GAAgBA,CAAAA,CAAQM,KADpC;AAGDyB,MAAAA,CAAAA,CAAGf,QAAHe,CAAYO,CAAZP,IADsB,QAApBA,CAAAA,CAAGf,QAAHe,CAAYO,CAAZP,CAAoB,IAtCFb,CAAAA,GAuCgBa,CAAAA,CAAGf,QAAHe,CAAYO,CAAZP,CAvChBb,EAAMC,CAAAA,GAAAA,CAAAA,CAAAA;AAwCxBE,QAAAA,MAAAA,EAAQiB;AAxCgBnB,OAAAA,EAyCrBnB,CAzCqBmB,CAAND,EAAgB;AACxCP,QAAAA,IAAAA,EAAMC,CAAAA,CAAa,CAACM,CAAAA,CAAKE,IAAN,EAAYD,CAAAA,CAAKC,IAAjB,CAAbR,CADkC;AAExCD,QAAAA,MAAAA,EAAQC,CAAAA,CAAa,CAACM,CAAAA,CAAKG,MAAN,EAAcF,CAAAA,CAAKE,MAAnB,CAAbT,CAFgC;AAGxC,QAAA,IAAA,EAAMU,CAAAA,CAAa,CAACJ,CAAAA,CAAKT,IAAN,EAAYU,CAAAA,CAAKV,IAAjB,CAAba,CAHkC;AAIxChB,QAAAA,KAAAA,GAXyB,CAAA,GAWA,CAACY,CAAAA,CAAKZ,KAAN,EAAaa,CAAAA,CAAKb,KAAlB,CAXA,EAWkBA,KAAAA,CAAAA,KAXlB,CAWkBA,KAXlB,CAAA,GAAS,EAWSA,CAXlB,EACa,YAAA,OAA/BO,CAAAA,CAAOnB,MAAPmB,CAActC,CAAdsC,EAAwB,CAAxBA,CAA+B,GAClCA,CAAAA,CAAOnB,MAAPmB,CAActC,CAAdsC,EAAwB,CAAxBA,CADkC,GAElC,IAQJP,CAJwC;AAKxCiB,QAAAA,WAAAA,EACoD,YAAA,OAA3CC,CAAAA,CAAa,CAACN,CAAD,EAAOC,CAAP,CAAbK,CAAAA,CAA2BD,WAAgB,GAC9CC,CAAAA,CAAa,CAACN,CAAD,EAAOC,CAAP,CAAbK,CAAAA,CAA2BD,WADmB,GAE9CL,CAAAA,CAAKK,WAR6B;AASxCE,QAAAA,SAAAA,EAAWb,CAAAA,CAAa,CAACM,CAAAA,CAAKO,SAAN,EAAiBN,CAAAA,CAAKM,SAAtB,CAAbb,CAT6B;AAUxCL,QAAAA,eAAAA,EAAiBK,CAAAA,CAAa,CAACM,CAAAA,CAAKX,eAAN,EAAuBY,CAAAA,CAAKZ,eAA5B,CAAbK,CAVuB;AAWxCgB,QAAAA,OAAAA,EAAShB,CAAAA,CAAa,CAACM,CAAAA,CAAKU,OAAN,EAAeT,CAAAA,CAAKS,OAApB,CAAbhB,CAX+B;AAYxCV,QAAAA,IAAAA,EAAM;AACJC,UAAAA,QAAAA,EAAUe,CAAAA,CAAKhB,IAALgB,CAAUf,QAAVe,IAAsBC,CAAAA,CAAKjB,IAALiB,CAAUhB,QADtC;AAEJO,UAAAA,UAAAA,EAAYQ,CAAAA,CAAKhB,IAALgB,CAAUR,UAAVQ,IAAwBC,CAAAA,CAAKjB,IAALiB,CAAUT,UAF1C;AAGJF,UAAAA,KAAAA,EAAOU,CAAAA,CAAKhB,IAALgB,CAAUV,KAAVU,IAAmBC,CAAAA,CAAKjB,IAALiB,CAAUX,KAHhC;AAIJqB,UAAAA,KAAAA,EAAOX,CAAAA,CAAKhB,IAALgB,CAAUW,KAAVX,IAAmBC,CAAAA,CAAKjB,IAALiB,CAAUU;AAJhC;AAZkC,OAsCd,IAtBYA,CAAAA,CAAAA;AA4BdR,QAAAA,MAAAA,EAAQiB;AA5BMT,OAAAA,EA4BE7B,CA5BF6B,CAuBlCE,EAOEA,CAAAA,CAAG5B,QAAH4B,KAAgB/B,CAAAA,CAAQqB,MAAxBU,KAAgCA,CAAAA,CAAG5B,QAAH4B,GAAcO,CAA9CP,CAPFA,EAQEA,CAAAA,CAAGvB,KAAHuB,KAAa/B,CAAAA,CAAQqB,MAArBU,KAA6BA,CAAAA,CAAGvB,KAAHuB,GAAWO,CAAxCP,CARFA,EASFA,CAAAA,CAAGQ,cAAHR,GAAoBA,CAAAA,CAAGQ,cAAHR,CAAkBS,GAAlBT,CAAsB,UAAA,CAAA,EAAA;AAAA,eACxC1D,CAAAA,KAAM2B,CAAAA,CAAQqB,MAAdhD,GAAuBiE,CAAvBjE,GAA6BA,CADW;AACXA,OADX0D,CATlBA,EAU6B1D,OAExB0D,CAAAA,CAAGf,QAAHe,CAAY/B,CAAAA,CAAQqB,MAApBU,CAZLA;AAYyBV,KAjBmB,EAiBnBA,CAAAA,GAAAA,CAjBmB,EAiBnBA,CAAAA,GAfTa,MAAAA,CAAOrB,MAAPqB,CAAcH,CAAAA,CAAGf,QAAjBkB,CAApB,EAAqClB,CAAAA,GAAAA,CAAAA,CAAAA,MAArC,EAAqCA,CAAAA,EAArC,EAAqCA,CAAAA;;AAiBrC,SAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAoBkB,MAAAA,CAAOrB,MAAPqB,CAAcH,CAAAA,CAAGf,QAAjBkB,CAApB,EAAqClB,CAAAA,GAAAA,CAAAA,CAAAA,MAArC,EAAqCA,CAAAA,EAArC,EAAgD;AAA3C,UAAIhB,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,CAAJ;AACHoC,MAAAA,CAAAA,CACErC,CAAAA,CAAuBC,CAAvBD,CADFqC,EAEE,iCAFFA,EAGEpC,CAHFoC,CAAAA;AAMF;;AAAA,WAAA,OAAA,CAAA,OAAA,CAAOH,CAAAA,CAAGF,CAAHE,CAAP,CAAA;AA1BiC,GAASF,CAAT,OAAA,CAAA,EAAA;AAAA,WAAA,OAAA,CAAA,MAAA,CAAA,CAAA,CAAA;AAAA;AAAA,CAvBW/C;AAAAA,IAoDjC+D,CAAAA,GAAkBE,CAAAA,CAAK,CAClCnB,CADkC,EAElCO,CAFkC,CAALY,CApDejE;;AAsD5CqD,SAAAA,CAAAA,IAAAA,sBAAAA,EAAAA,CAAAA,IAAAA,uBAAAA,EAAAA,CAAAA,IAAAA,eAAAA","sourcesContent":["import {pipe, isTransaction, Ok} from \"@onflow/interaction\"\n\nconst isFn = d => typeof d === \"function\"\nconst isNumber = d => typeof d === \"number\"\nconst isString = d => typeof d === \"string\"\n\nconst invariant = (fact, msg, ...rest) => {\n  if (!fact) {\n    const error = new Error(`INVARIANT ${msg}`)\n    error.stack = error.stack\n      .split(\"\\n\")\n      .filter(d => !/at invariant/.test(d))\n      .join(\"\\n\")\n    console.error(\"\\n\\n---\\n\\n\", error, \"\\n\\n\", ...rest, \"\\n\\n---\\n\\n\")\n    throw error\n  }\n}\n\nconst accountCanFulfillRoles = account => {\n  if (account.role.proposer) {\n    if (\n      !isString(account.addr) ||\n      !isNumber(account.keyId) ||\n      !isNumber(account.sequenceNum) ||\n      !isFn(account.signingFunction)\n    )\n      return false\n  }\n  if (account.role.payer) {\n    if (\n      !isString(account.addr) ||\n      !isNumber(account.keyId) ||\n      !isFn(account.signingFunction)\n    )\n      return false\n  }\n  if (account.role.authorizer) {\n    if (\n      !isString(account.addr) ||\n      !isNumber(account.keyId) ||\n      !isFn(account.signingFunction)\n    )\n      return false\n  }\n  return true\n}\n\nconst firstNonNull = (values = []) => values.filter(Boolean)[0] || null\nconst firstNonNullKeyId = (values = []) =>\n  typeof values.filter(isNumber)[0] === \"number\"\n    ? values.filter(isNumber)[0]\n    : null\nconst findProposer = (accounts = []) =>\n  accounts.find(d => d.role.proposer) || {}\n\nconst deepMergeAccount = (into, from) => ({\n  kind: firstNonNull([into.kind, from.kind]),\n  tempId: firstNonNull([into.tempId, from.tempId]),\n  addr: firstNonNull([into.addr, from.addr]),\n  keyId: firstNonNullKeyId([into.keyId, from.keyId]),\n  sequenceNum:\n    typeof findProposer([into, from]).sequenceNum === \"number\"\n      ? findProposer([into, from]).sequenceNum\n      : into.sequenceNum,\n  signature: firstNonNull([into.signature, from.signature]),\n  signingFunction: firstNonNull([into.signingFunction, from.signingFunction]),\n  resolve: firstNonNull([into.resolve, from.resolve]),\n  role: {\n    proposer: into.role.proposer || from.role.proposer,\n    authorizer: into.role.authorizer || from.role.authorizer,\n    payer: into.role.payer || from.role.payer,\n    param: into.role.param || from.role.param,\n  },\n})\n\nexport const enforceResolvedAccounts = async ix => {\n  if (!isTransaction(ix)) return Ok(ix)\n  for (let [tempId, account] of Object.entries(ix.accounts)) {\n    if (isFn(account.resolve))\n      ix.accounts[tempId] = await account.resolve(account)\n    invariant(\n      accountCanFulfillRoles(ix.accounts[tempId]),\n      \"Account unable to fulfill role\",\n      ix.accounts[tempId]\n    )\n  }\n  return Ok(ix)\n}\n\nexport const dedupeResolvedAccounts = async ix => {\n  if (!isTransaction(ix)) return Ok(ix)\n  for (let account of Object.values(ix.accounts)) {\n    const cid = `${account.addr}|${account.keyId}`\n    if (ix.accounts[cid] != null) {\n      ix.accounts[cid] = deepMergeAccount(ix.accounts[cid], {\n        tempId: cid,\n        ...account,\n      })\n    } else {\n      ix.accounts[cid] = {tempId: cid, ...account}\n    }\n    if (ix.proposer === account.tempId) ix.proposer = cid\n    if (ix.payer === account.tempId) ix.payer = cid\n    ix.authorizations = ix.authorizations.map(d =>\n      d === account.tempId ? cid : d\n    )\n    delete ix.accounts[account.tempId]\n  }\n  for (let account of Object.values(ix.accounts)) {\n    invariant(\n      accountCanFulfillRoles(account),\n      \"Account unable to fulfill roles\",\n      account\n    )\n  }\n  return Ok(ix)\n}\n\nexport const resolveAccounts = pipe([\n  enforceResolvedAccounts,\n  dedupeResolvedAccounts,\n])\n"]},"metadata":{},"sourceType":"module"}